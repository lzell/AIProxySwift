//
//  FalFlux2InputSchema.swift
//  AIProxy
//
//  Created by Lou Zell on 12/23/25.
//

/// Input schema for `fal-ai/flux-2`.
/// Generated from Fal's API documentation.
/// https://fal.ai/models/fal-ai/flux-2/api#schema-input
public struct FalFlux2InputSchema: Encodable, Sendable {
    // Required

    /// The prompt to generate an image from.
    public let prompt: String

    // Optional

    /// Guidance Scale is a measure of how close you want the model to stick to your prompt
    /// when looking for a related image to show you. Default value: 2.5
    public let guidanceScale: Float?

    /// The seed to use for the generation. If not provided, a random seed will be used.
    public let seed: Int?

    /// The number of inference steps to perform. Default value: 28
    public let numInferenceSteps: Int?

    /// The size of the image to generate. The width and height must be between 512 and 2048 pixels.
    /// Default value: landscape_4_3
    ///
    /// For custom image sizes, you can pass `ImageSize.custom(width:height:)`.
    public let imageSize: ImageSize?

    /// The number of images to generate. Default value: 1
    public let numImages: Int?

    /// The acceleration level to use for the image generation. Default value: "regular"
    public let acceleration: Acceleration?

    /// If set to true, the prompt will be expanded for better results.
    public let enablePromptExpansion: Bool?

    /// If True, the media will be returned as a data URI and the output data won't be
    /// available in the request history.
    public let syncMode: Bool?

    /// If set to true, the safety checker will be enabled. Default value: true
    public let enableSafetyChecker: Bool?

    /// The format of the generated image. Default value: "png"
    public let outputFormat: OutputFormat?

    private enum CodingKeys: String, CodingKey {
        case prompt
        case guidanceScale = "guidance_scale"
        case seed
        case numInferenceSteps = "num_inference_steps"
        case imageSize = "image_size"
        case numImages = "num_images"
        case acceleration
        case enablePromptExpansion = "enable_prompt_expansion"
        case syncMode = "sync_mode"
        case enableSafetyChecker = "enable_safety_checker"
        case outputFormat = "output_format"
    }

    // This memberwise initializer is autogenerated.
    public init(
        prompt: String,
        guidanceScale: Float? = nil,
        seed: Int? = nil,
        numInferenceSteps: Int? = nil,
        imageSize: ImageSize? = nil,
        numImages: Int? = nil,
        acceleration: Acceleration? = nil,
        enablePromptExpansion: Bool? = nil,
        syncMode: Bool? = nil,
        enableSafetyChecker: Bool? = nil,
        outputFormat: OutputFormat? = nil
    ) {
        self.prompt = prompt
        self.guidanceScale = guidanceScale
        self.seed = seed
        self.numInferenceSteps = numInferenceSteps
        self.imageSize = imageSize
        self.numImages = numImages
        self.acceleration = acceleration
        self.enablePromptExpansion = enablePromptExpansion
        self.syncMode = syncMode
        self.enableSafetyChecker = enableSafetyChecker
        self.outputFormat = outputFormat
    }
}

// MARK: - Enumerations
extension FalFlux2InputSchema {

    /// The format of the generated image.
    public enum OutputFormat: String, Encodable, Sendable {
        case jpeg
        case png
        case webp
    }

    /// The acceleration level to use for the image generation.
    public enum Acceleration: String, Encodable, Sendable {
        case noAcceleration = "none"
        case regular
        case high
    }

    /// The size of the image to generate.
    ///
    /// Use one of the preset sizes or `.custom(width:height:)` for custom dimensions.
    /// Custom width and height must be between 512 and 2048 pixels.
    public enum ImageSize: Encodable, Sendable {
        case squareHD
        case square
        case portrait4x3
        case portrait16x9
        case landscape4x3
        case landscape16x9
        case custom(width: Int, height: Int)

        public func encode(to encoder: Encoder) throws {
            var container = encoder.singleValueContainer()
            switch self {
            case .squareHD:
                try container.encode("square_hd")
            case .square:
                try container.encode("square")
            case .portrait4x3:
                try container.encode("portrait_4_3")
            case .portrait16x9:
                try container.encode("portrait_16_9")
            case .landscape4x3:
                try container.encode("landscape_4_3")
            case .landscape16x9:
                try container.encode("landscape_16_9")
            case .custom(let width, let height):
                try container.encode(["width": width, "height": height])
            }
        }
    }
}
