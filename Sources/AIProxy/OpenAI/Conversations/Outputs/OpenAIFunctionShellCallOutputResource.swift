//
//  OpenAIFunctionShellCallOutputResource.swift
//  AIProxy
//
//  Created by Lou Zell on 12/22/25.
//
// OpenAPI spec: FunctionShellCallOutput, version 2.3.0, line 23435

/// The output of a shell tool call.
nonisolated public struct OpenAIFunctionShellCallOutputResource: Decodable, Sendable {
    /// The unique ID of the shell tool call generated by the model.
    public let callID: String

    /// The unique ID of the shell call output. Populated when this item is returned via API.
    public let id: String

    /// The maximum length of the shell command output.
    ///
    /// This is generated by the model and should be passed back with the raw output.
    public let maxOutputLength: Int?

    /// An array of shell call output contents.
    public let output: [OpenAIFunctionShellCallOutputContent]

    /// The type of the shell call output. Always `shell_call_output`.
    public let type: String

    /// The ID of the entity that created this output.
    public let createdBy: String?

    private enum CodingKeys: String, CodingKey {
        case callID = "call_id"
        case id
        case maxOutputLength = "max_output_length"
        case output
        case type
        case createdBy = "created_by"
    }
}

/// The content of a shell call output.
nonisolated public struct OpenAIFunctionShellCallOutputContent: Decodable, Sendable {
    /// The outcome of the shell call.
    public let outcome: OpenAIFunctionShellCallOutcome

    /// The standard error output.
    public let stderr: String

    /// The standard output.
    public let stdout: String

    /// The ID of the entity that created this output.
    public let createdBy: String?

    private enum CodingKeys: String, CodingKey {
        case outcome
        case stderr
        case stdout
        case createdBy = "created_by"
    }
}

/// Represents either an exit outcome (with an exit code) or a timeout outcome for a shell call output chunk.
nonisolated public enum OpenAIFunctionShellCallOutcome: Decodable, Sendable {
    case exit(OpenAIFunctionShellCallExitOutcome)
    case timeout(OpenAIFunctionShellCallTimeoutOutcome)

    private enum CodingKeys: String, CodingKey {
        case type
    }

    public init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        let type = try container.decode(String.self, forKey: .type)

        switch type {
        case "exit":
            self = .exit(try OpenAIFunctionShellCallExitOutcome(from: decoder))
        case "timeout":
            self = .timeout(try OpenAIFunctionShellCallTimeoutOutcome(from: decoder))
        default:
            throw DecodingError.dataCorruptedError(
                forKey: .type,
                in: container,
                debugDescription: "Unknown shell call outcome type: \(type)"
            )
        }
    }
}

/// Indicates that the shell commands finished and returned an exit code.
nonisolated public struct OpenAIFunctionShellCallExitOutcome: Decodable, Sendable {
    /// Exit code from the shell process.
    public let exitCode: Int

    /// The outcome type. Always `exit`.
    public let type: String

    private enum CodingKeys: String, CodingKey {
        case exitCode = "exit_code"
        case type
    }
}

/// Indicates that the shell call exceeded its configured time limit.
nonisolated public struct OpenAIFunctionShellCallTimeoutOutcome: Decodable, Sendable {
    /// The outcome type. Always `timeout`.
    public let type: String

    private enum CodingKeys: String, CodingKey {
        case type
    }
}
