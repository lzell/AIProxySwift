//
//  OpenAIFunctionToolCallOutputResource.swift
//  AIProxy
//
//  Created by Lou Zell on 12/22/25.
//
// OpenAPI spec: FunctionToolCallOutputResource, version 2.3.0, line 9757

/// The output of a function tool call.
nonisolated public struct OpenAIFunctionToolCallOutputResource: Decodable, Sendable {
    /// The unique ID of the function tool call generated by the model.
    public let callID: String

    /// The unique ID of the function call tool output.
    public let id: String

    /// The output from the function call generated by your code.
    ///
    /// Can be a string or a list of output content.
    public let output: OpenAIFunctionToolCallOutputValue

    /// The type of the function tool call output. Always `function_call_output`.
    public let type: String

    /// The status of the item.
    ///
    /// One of `in_progress`, `completed`, or `incomplete`. Populated when items are returned via API.
    public let status: OpenAIFunctionToolCallStatus?

    private enum CodingKeys: String, CodingKey {
        case callID = "call_id"
        case id
        case output
        case type
        case status
    }
}

/// The output value of a function tool call.
nonisolated public enum OpenAIFunctionToolCallOutputValue: Decodable, Sendable {
    case string(String)
    case content([OpenAIFunctionToolCallOutputContent])

    public init(from decoder: Decoder) throws {
        let container = try decoder.singleValueContainer()
        if let stringValue = try? container.decode(String.self) {
            self = .string(stringValue)
        } else if let contentArray = try? container.decode([OpenAIFunctionToolCallOutputContent].self) {
            self = .content(contentArray)
        } else {
            throw DecodingError.typeMismatch(
                OpenAIFunctionToolCallOutputValue.self,
                DecodingError.Context(
                    codingPath: decoder.codingPath,
                    debugDescription: "Expected String or array of output content"
                )
            )
        }
    }
}

/// Output content for a function or custom tool call.
nonisolated public enum OpenAIFunctionToolCallOutputContent: Decodable, Sendable {
    case inputFile(OpenAIInputFileContentResource)
    case inputImage(OpenAIInputImageContentResource)
    case inputText(OpenAIInputTextContentResource)

    private enum CodingKeys: String, CodingKey {
        case type
    }

    public init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        let type = try container.decode(String.self, forKey: .type)

        switch type {
        case "input_file":
            self = .inputFile(try OpenAIInputFileContentResource(from: decoder))
        case "input_image":
            self = .inputImage(try OpenAIInputImageContentResource(from: decoder))
        case "input_text":
            self = .inputText(try OpenAIInputTextContentResource(from: decoder))
        default:
            throw DecodingError.dataCorruptedError(
                forKey: .type,
                in: container,
                debugDescription: "Unknown function tool call output content type: \(type)"
            )
        }
    }
}
