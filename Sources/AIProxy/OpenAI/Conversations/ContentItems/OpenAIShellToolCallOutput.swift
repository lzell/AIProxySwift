//
//  OpenAIShellToolCallOutput.swift
//  AIProxy
//
//  Created by Lou Zell on 12/21/25.
//
// OpenAPI spec: FunctionShellCallOutputItemParam, version 2.3.0, line 66051
// https://platform.openai.com/docs/api-reference/conversations/create#conversations_create-items-item-shell_tool_call_output

/// The streamed output items emitted by a shell tool call.
nonisolated public struct OpenAIShellToolCallOutput: Encodable, Sendable {
    /// The unique ID of the shell tool call generated by the model.
    public let callID: String

    /// Captured chunks of stdout and stderr output, along with their associated outcomes.
    public let output: [Output]

    /// The type of the item. Always `shell_call_output`.
    public let type = "shell_call_output"

    /// The unique ID of the shell tool call output. Populated when this item is returned via API.
    public let id: String?

    /// The maximum number of UTF-8 characters captured for this shell call's combined output.
    public let maxOutputLength: Int?

    /// Creates a new shell tool call output item parameter.
    /// - Parameters:
    ///   - callID: The unique ID of the shell tool call generated by the model.
    ///   - output: Captured chunks of stdout and stderr output, along with their associated outcomes.
    ///   - id: The unique ID of the shell tool call output.
    ///   - maxOutputLength: The maximum number of UTF-8 characters captured for this shell call's combined output.
    public init(
        callID: String,
        output: [FunctionShellCallOutputContentParam],
        id: String? = nil,
        maxOutputLength: Int? = nil
    ) {
        self.callID = callID
        self.output = output
        self.id = id
        self.maxOutputLength = maxOutputLength
    }

    private enum CodingKeys: String, CodingKey {
        case callID = "call_id"
        case output
        case type
        case id
        case maxOutputLength = "max_output_length"
    }

    public func encode(to encoder: Encoder) throws {
        var container = encoder.container(keyedBy: CodingKeys.self)
        try container.encode(callID, forKey: .callID)
        try container.encode(output, forKey: .output)
        try container.encode(type, forKey: .type)
        try container.encodeIfPresent(id, forKey: .id)
        try container.encodeIfPresent(maxOutputLength, forKey: .maxOutputLength)
    }
}

extension OpenAIShellToolCallOutput {
    /// Captured stdout and stderr for a portion of a shell tool call output.
    nonisolated public struct Output: Encodable, Sendable {
        /// The exit or timeout outcome associated with this shell call.
        public let outcome: OpenAIShellToolCallOutcome

        /// Captured stderr output for the shell call.
        public let stderr: String

        /// Captured stdout output for the shell call.
        public let stdout: String

        /// Creates a new shell output content parameter.
        /// - Parameters:
        ///   - outcome: The exit or timeout outcome associated with this shell call.
        ///   - stderr: Captured stderr output for the shell call.
        ///   - stdout: Captured stdout output for the shell call.
        public init(
            outcome: OpenAIShellToolCallOutcome,
            stderr: String,
            stdout: String
        ) {
            self.outcome = outcome
            self.stderr = stderr
            self.stdout = stdout
        }

        private enum CodingKeys: String, CodingKey {
            case outcome
            case stderr
            case stdout
        }

        public func encode(to encoder: Encoder) throws {
            var container = encoder.container(keyedBy: CodingKeys.self)
            try container.encode(outcome, forKey: .outcome)
            try container.encode(stderr, forKey: .stderr)
            try container.encode(stdout, forKey: .stdout)
        }
    }
}
